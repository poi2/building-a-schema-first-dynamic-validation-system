# Design Doc 6: Monorepo 構成 & ビルド戦略

複数のサービスを 1 つのリポジトリで管理するため、以下のルールを定めます。

## 1. ディレクトリ構造

```bash
celo/
├── proto/               # Single Source of Truth
│   ├── buf.yaml
│   └── schema/v1/       # .proto ファイル群
├── gen/                 # 生成コード (Go/TS) ※各サービスから参照
├── services/
│   ├── isr/             # Go: Schema Registry
│   ├── be/              # Go: Main Backend
│   ├── bff/             # Node.js: Connect Proxy
│   └── fe/              # React: Frontend
├── tests/
│   ├── integration/     # Go: Testcontainers Integration Tests
│   └── e2e/             # TS: Playwright Scenarios
├── scripts/             # 開発用補助スクリプト
└── docker-compose.yml

```

## 2. 依存管理のルール

* **Go**: ルートに `go.work` (Go Workspaces) を置き、`isr`, `be`, `tests` をマルチモジュールとして管理。
* **Node.js**: ルートに `package.json` を置き、npm workspaces を使って `bff`, `fe`, `e2e` を管理。
* **Proto**: `buf generate` の出力先を共通の `gen/` ディレクトリに集約し、各サービスはそこから import する。

## 3. CI 戦略 (GitHub Actions)

* **Path-based trigger**: `services/be/**` が変更されたときのみ BE のテストを走らせるなど、無駄なビルドを避ける設定を行う。
